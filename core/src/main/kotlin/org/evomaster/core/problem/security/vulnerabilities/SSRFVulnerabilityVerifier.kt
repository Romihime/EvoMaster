package org.evomaster.core.problem.security.rest

import com.github.tomakehurst.wiremock.WireMockServer
import com.github.tomakehurst.wiremock.client.WireMock
import com.github.tomakehurst.wiremock.core.WireMockConfiguration
import com.github.tomakehurst.wiremock.extension.responsetemplating.ResponseTemplateTransformer
import org.evomaster.client.java.instrumentation.shared.VulnerabilityAnalyserSharedUtils
import org.evomaster.core.problem.security.VulnerabilityVerifier

class SSRFVulnerabilityVerifier : VulnerabilityVerifier() {

    private var wireMockServer: WireMockServer? = null

    private var traceTokens: MutableMap<String, String> = mutableMapOf()

    override fun init() {
        val config = WireMockConfiguration()
            .bindAddress(VulnerabilityAnalyserSharedUtils.SSRF_VERIFIER_WM_IP)
            .extensions(ResponseTemplateTransformer(false))
            .httpsPort(8080)

        wireMockServer = WireMockServer(config)
        wireMockServer!!.start()
        wireMockServer!!.stubFor(
            WireMock.any(WireMock.anyUrl())
                .atPriority(1)
                .willReturn(
                    WireMock.aResponse()
                        .withStatus(200)
                        .withBody("WORKING")
                )
        )
    }

    fun prepare() {
        
    }

    override fun verify() {

    }

    private fun initialiseVerifier() {
        wireMockServer = WireMockServer(8089)
    }

    private fun resetHTTPVerifier() {
        wireMockServer?.resetAll()
    }
}
